import e from"fingerprintjs2";import t from"ua-parser-js";var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function o(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e,t){return e(t={exports:{}},t.exports),t.exports}var s=n((function(e,t){t.__esModule=!0,t.default=function(e,t,r){var o=new XMLHttpRequest;o.onreadystatechange=function(){XMLHttpRequest.DONE===this.readyState&&t(200!==this.status&&new Error("StatisticsPlugin: server respnse status is "+this.status),this.responseText,this)},o.open(r.method?r.method.toUpperCase():"GET",e,!0),"boolean"==typeof r.withCredentials&&(o.withCredentials=r.withCredentials),r.headers&&(Object.keys(r.headers).forEach((function(e){void 0!==r.headers[e]&&null!==r.headers[e]&&o.setRequestHeader(e,r.headers[e])})),r.headers["Content-Type"]||o.setRequestHeader("Content-Type","application/x-www-form-urlencoded")),r.post?o.send(r.post):o.send()}}));o(s);var i=n((function(e,t){t.__esModule=!0,t.parseURLSearch=void 0,t.parseURLSearch=function(e){void 0===e&&(e=window.location.search);var t={};e.length&&("?"===e[0]&&(e=e.slice(1)),e.split("&").forEach((function(e){var r=e.split("=");t[r[0]]=decodeURIComponent(r[1])})));return t}}));o(i),i.parseURLSearch;var a=o(n((function(o,n){var a=r&&r.__assign||function(){return(a=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};n.__esModule=!0;var l=window.localStorage.getItem("TZ_USER_MURMUR");l||e.default.get(null,(function(t){l=e.default.x64hash128(t.map((function(e){return e.value})).join(""),31),window.localStorage.setItem("TZ_USER_MURMUR",l)}));var d=t.default(),p=d.browser,c=d.os,u=d.device,h=window.navigator,f=h.connection||h.mozConnection||h.webkitConnection,v=function(){function e(e){this.options=Object.assign({},e),this.referrer=window.document.referrer,this.params={device_id:l,device_width:window.screen.width,device_height:window.screen.height,device_makers:u.vendor,os_name:c.name,os_version:c.version,browser:p.name,browser_version:p.version},(null==f?void 0:f.type)&&(this.params.is_wifi="wifi"===f.type.toLocaleLowerCase())}return e.prototype.registerUserToken=function(e){this.options.token=e},e.prototype.resolveChannelId=function(e){var t=i.parseURLSearch().channelId,r=e.targetUrl;if(!t&&r){var o=r.split("?")[1];o&&(t=i.parseURLSearch(o).channelId)}return t},e.prototype.resolveReportData=function(e,t){var r=JSON.parse(JSON.stringify(t)),o=this.resolveChannelId(r);r.targetUrl&&delete r.targetUrl;var n=a(a(a(a({},this.params),{begin_time:Date.now(),current_url:window.location.href,referrer_url:this.referrer}),r),{event_id:e});return o&&(n.channel=o),n},e.prototype.report=function(e,t){void 0===t&&(t={});var r=this.resolveReportData(e,t);try{s.default(this.options.url,(function(e){e&&console.log(e)}),{post:JSON.stringify(r),method:"post",headers:{"Content-Type":"application/json;charset=UTF-8",token:this.options.token,terminalType:this.options.terminal}})}catch(e){console.error(e)}},e}();n.default=v}))),l=n((function(e,t){t.__esModule=!0}));o(l);export{l as __moduleExports,a as default};
